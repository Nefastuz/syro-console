<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consola SYRÓ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f0f2f5; }
        #main-container { width: 100%; max-width: 600px; height: 90vh; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        #header { padding: 15px; border-bottom: 1px solid #ddd; font-size: 1.2em; font-weight: bold; color: #333; }
        #chatbox { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        #input-area { padding: 15px; border-top: 1px solid #ddd; }
        #input-form { display: flex; gap: 10px; }
        #userInput { flex: 1; border: 1px solid #ccc; padding: 10px; border-radius: 18px; }
        #sendButton { background-color: #007bff; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 18px; font-weight: bold; }
        .controls { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; font-size: 12px; color: #555; padding: 0 5px; }
        .msg { padding: 10px 15px; border-radius: 18px; max-width: 80%; line-height: 1.4; word-wrap: break-word; }
        .user-msg { background-color: #007bff; color: white; align-self: flex-end; }
        .syro-msg { background-color: #e9ecef; color: #333; align-self: flex-start; white-space: pre-wrap; }
    </style>
</head>
<body>

<div id="main-container">
    <div id="header">Consola de Interacción SYRÓ v2.0</div>
    <div id="chatbox">
        <div class="syro-msg">SYRÓ v1.7 (Local) listo. Conexión directa establecida.</div>
    </div>
    <div id="input-area">
        <form id="input-form" onsubmit="sendMessage(event)">
            <input type="text" id="userInput" placeholder="Pregunta o instruye a SYRÓ..." autocomplete="off">
            <button type="submit" id="sendButton">Enviar</button>
        </form>
        <div class="controls">
            <div>
                <input type="radio" id="mode-synthesis" name="syro-mode" value="SYNTESIS" checked> <label for="mode-synthesis">Síntesis</label>
                <input type="radio" id="mode-kha" name="syro-mode" value="KHA"> <label for="mode-kha">KHA</label>
                <input type="radio" id="mode-mos" name="syro-mode" value="MOS"> <label for="mode-mos">MOS</label>
            </div>
            <div>
                <input type="checkbox" id="chainMode"> <label for="chainMode">Modo Autónomo</label>
            </div>
        </div>
    </div>
</div>

<script>
    // ¡¡¡ IMPORTANTE !!!
    // Pega aquí la URL de tu Web App. Prueba primero con la que termina en /exec.
    // Si esa falla, usa la que termina en /dev.
    const SYRO_API_URL = "https://script.google.com/macros/s/AKfycbzJ1hpY-UfXHi-EGCZ4TKenkitAM-4Cr3xK03bd4ZDfLf1jOikXBn7VLEA6SzG_xjSQaA/exec";

    // --- El resto del script no necesita cambios ---
    const chatbox = document.getElementById('chatbox');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');

    function addMessage(text, isUser) {
        const msgDiv = document.createElement('div');
        msgDiv.className = isUser ? 'msg user-msg' : 'msg syro-msg';
        msgDiv.textContent = text;
        chatbox.appendChild(msgDiv);
        chatbox.scrollTop = chatbox.scrollHeight;
    }

    function sendMessage(event) {
        event.preventDefault();
        const userText = userInput.value.trim();
        if (!userText || SYRO_API_URL === "URL_DE_TU_WEB_APP_AQUI") {
            if (SYRO_API_URL === "URL_DE_TU_WEB_APP_AQUI") {
                addMessage("Error de configuración: Debes pegar la URL de la API de SYRÓ en el archivo syro_console.html.", false);
            }
            return;
        }

        addMessage(userText, true);
        userInput.value = "";
        sendButton.disabled = true;

        const isChainMode = document.getElementById('chainMode').checked;
        const selectedMode = document.querySelector('input[name="syro-mode"]:checked').value;
        const action = isChainMode ? "EXECUTE_CHAIN" : "ASK_SYRO";
        const paramName = isChainMode ? "INSTRUCTION" : "PROMPT";
        let command = `${action}::${paramName}="${userText}"`;
        if (action === 'ASK_SYRO') {
            command += `::MODE=${selectedMode}`;
        }
        const finalUrl = `${SYRO_API_URL}?cmd=${encodeURIComponent(command)}`;

        addMessage("Procesando...", false);
        const thinkingMsg = chatbox.lastChild;

        fetch(finalUrl)
            .then(res => {
                if (!res.ok) { throw new Error(`Error de red: ${res.status} ${res.statusText}`); }
                return res.json();
            })
            .then(data => {
                thinkingMsg.textContent = data.data || data.message;
            })
            .catch(err => {
                thinkingMsg.textContent = `Error Crítico: ${err.message}. Verifica la URL de la API y la consola de Apps Script.`;
            })
            .finally(() => {
                sendButton.disabled = false;
                userInput.focus();
            });
    }
</script>

</body>

</html>

